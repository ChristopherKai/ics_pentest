FROM phusion/baseimage:master-amd64
USER root
COPY entrypoint.sh /opt
WORKDIR /opt
    # IOT 

RUN sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list && apt-get update && \
    apt-get install git python2 nmap -y && apt-get clean && rm -rf /var/lib/apt/lists/*
RUN sed -i "s|#PermitRootLogin yes|PermitRootLogin yes|g"  /etc/ssh/sshd_config && \
    echo "root:root" | chpasswd && chmod +x /opt/entrypoint.sh &&\
    ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key && \
    ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key 
    
RUN echo "root:root" | chpasswd && chmod +x /opt/entrypoint.sh
    # pentest
RUN cd /tmp && curl https://bootstrap.pypa.io/pip/2.7/get-pip.py --output get-pip.py &&  python2 get-pip.py && cd - &&\
    git clone https://github.com/dark-lbp/isf.git --depth=1&& cd isf && pip2 install requests paramiko beautifulsoup4 pysnmp gnureadline python-nmap scapy && ln -sf /opt/isf/isf.py /usr/local/bin/isf  && cd - \
    && curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && chmod 755 msfinstall && ./msfinstall

RUN git clone https://github.com/offensive-security/exploit-database.git  --depth=1 && ln -sf /opt/exploit-database/searchsploit /usr/local/bin/searchsploit 

EXPOSE 22
ENTRYPOINT [ "/opt/entrypoint.sh" ]